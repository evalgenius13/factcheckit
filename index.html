<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Fact-CheckIt - Instant AI Fact Checking</title>
  <style>
    /* same polish styles you pasted */
    /* ... truncated for brevity (use your CSS exactly as-is) ... */
    .source-fallback {
      display: block;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      background-color: #fff7ed;
      border: 1px dashed #f97316;
      color: #9a3412;
      font-size: 0.9rem;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">🔍</div>
      <h1>Fact-CheckIt</h1>
      <p class="subtitle">Paste → Fact-Check → Done</p>
      <div class="status">
        <div class="status-dot"></div>
        <span class="status-text">AI-Powered</span>
      </div>
    </div>

    <!-- Input Form -->
    <div class="card">
      <div class="form-group">
        <label for="claim">📝 Paste the claim to fact-check:</label>
        <div class="textarea-container">
          <textarea 
            id="claim" 
            placeholder="Paste the comment or claim you want to fact-check..."
            oninput="updateCharCount()"
          ></textarea>
          <div class="char-counter" id="charCounter">0/1000</div>
        </div>
      </div>
      <button class="btn btn-primary" onclick="factCheck()" id="factCheckBtn">
        ⚡ Fact-Check It!
      </button>
    </div>

    <!-- Results -->
    <div id="results"></div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>🤖 Powered by AI • Always verify important claims</p>
    <div class="footer-badges">
      <span>🔒 Secure</span>
      <span>⚡ Fast</span>
      <span>🎯 Accurate</span>
    </div>
  </div>

  <script>
    let isLoading = false;

    function updateCharCount() {
      const textarea = document.getElementById('claim');
      const counter = document.getElementById('charCounter');
      counter.textContent = `${textarea.value.length}/1000`;
    }

    async function factCheck() {
      const claim = document.getElementById('claim').value.trim();
      const btn = document.getElementById('factCheckBtn');
      const results = document.getElementById('results');

      if (!claim || isLoading) return;

      // Set loading state
      isLoading = true;
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> Fact-Checking...';
      results.innerHTML = '';

      try {
        const response = await fetch('/api/fact-check', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ claim: claim }),
        });

        const data = await response.json();

        if (data.success) {
          showResults(data);
        } else {
          showError(data.error || 'Something went wrong');
        }
      } catch (error) {
        showError('Network error. Please try again.');
      } finally {
        isLoading = false;
        btn.disabled = false;
        btn.innerHTML = '⚡ Fact-Check It!';
      }
    }

    function showResults(data) {
      const results = document.getElementById('results');

      const verdictClass = {
        'TRUE': 'verdict-true',
        'FALSE': 'verdict-false',
        'MISLEADING': 'verdict-misleading'
      }[data.verdict] || 'verdict-unknown';

      const verdictEmoji = {
        'TRUE': '✅',
        'FALSE': '❌',
        'MISLEADING': '⚠️'
      }[data.verdict] || '🔍';

      const verdictText = {
        'TRUE': 'VERIFIED TRUE',
        'FALSE': 'FALSE CLAIM',
        'MISLEADING': 'MISLEADING'
      }[data.verdict] || 'CANNOT VERIFY';

      // Explanation text (summary alias)
      const explanation = (data.summary || data.explanation || '').trim();

      let sourcesHtml = '';
      if (data.sources && data.sources.length > 0) {
        const rendered = data.sources.map(source => {
          const isFallback = source.title?.startsWith('Source retrieval failed');
          if (isFallback) {
            return `<a href="${source.url}" target="_blank" rel="noopener noreferrer" class="source-fallback">⚠️ ${source.title}</a>`;
          }
          return `<a href="${source.url}" target="_blank" rel="noopener noreferrer" class="source-link">🔗 ${source.title}</a>`;
        }).join('');
        sourcesHtml = `
          <div class="sources">
            <h4>📚 SOURCES:</h4>
            ${rendered}
          </div>
        `;
      }

      results.innerHTML = `
        <div class="card result">
          <div class="verdict-badge ${verdictClass}">
            <span>${verdictEmoji}</span>
            ${verdictText}
          </div>
          <p class="explanation">${explanation}</p>
          ${sourcesHtml}
        </div>
      `;
    }

    function showError(message) {
      const results = document.getElementById('results');
      results.innerHTML = `
        <div class="card result">
          <div class="error">
            <div class="error-icon">❌</div>
            <h3>Error</h3>
            <p>${message}</p>
          </div>
        </div>
      `;
    }

    document.getElementById('claim').addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        factCheck();
      }
    });
  </script>
</body>
</html>
